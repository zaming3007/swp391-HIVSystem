<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Profile Navigation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">
                            <i class="fas fa-user-cog me-2"></i>
                            Test Profile Navigation & Authentication
                        </h3>
                    </div>
                    <div class="card-body">
                        <div id="status" class="mb-3"></div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="d-grid gap-2">
                                    <button id="checkAuthStatus" class="btn btn-info">
                                        <i class="fas fa-shield-alt me-2"></i>
                                        1. Check Auth Status
                                    </button>
                                    <button id="testLogin" class="btn btn-success">
                                        <i class="fas fa-sign-in-alt me-2"></i>
                                        2. Test Login
                                    </button>
                                    <button id="testProfile" class="btn btn-primary">
                                        <i class="fas fa-user me-2"></i>
                                        3. Test Profile API
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-grid gap-2">
                                    <button id="testMyAppointments" class="btn btn-warning">
                                        <i class="fas fa-calendar me-2"></i>
                                        4. Test My Appointments
                                    </button>
                                    <button id="testReactApp" class="btn btn-secondary">
                                        <i class="fab fa-react me-2"></i>
                                        5. Test React App Navigation
                                    </button>
                                    <a href="/" class="btn btn-outline-primary">
                                        <i class="fas fa-home me-2"></i>
                                        V·ªÅ Trang Ch√≠nh
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div id="results" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        function showResults(title, data, type = 'info') {
            const resultsDiv = document.getElementById('results');

            let content = `
                <div class="card border-${type}">
                    <div class="card-header bg-${type} text-white">
                        <h5 class="mb-0">${title}</h5>
                    </div>
                    <div class="card-body">
                        <pre class="bg-light p-3 rounded" style="max-height: 400px; overflow-y: auto; font-size: 12px;">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = content;
        }

        // 1. Check Auth Status
        document.getElementById('checkAuthStatus').addEventListener('click', async () => {
            showStatus('ƒêang ki·ªÉm tra authentication status...', 'info');
            try {
                const response = await fetch('/api/database/auth-status');
                const data = await response.json();

                if (response.ok) {
                    if (data.isAuthenticated) {
                        showStatus(`‚úÖ ƒê√£ ƒëƒÉng nh·∫≠p: ${data.user.fullName}`, 'success');
                    } else {
                        showStatus('‚ö†Ô∏è Ch∆∞a ƒëƒÉng nh·∫≠p', 'warning');
                    }
                    showResults('Auth Status', data, data.isAuthenticated ? 'success' : 'warning');
                } else {
                    showStatus(`‚ùå L·ªói ki·ªÉm tra auth: ${data.message}`, 'danger');
                    showResults('Auth Error', data, 'danger');
                }
            } catch (error) {
                showStatus(`‚ùå L·ªói k·∫øt n·ªëi: ${error.message}`, 'danger');
            }
        });

        // 2. Test Login
        document.getElementById('testLogin').addEventListener('click', async () => {
            showStatus('ƒêang test login...', 'info');
            try {
                const loginData = {
                    username: 'admin',
                    password: '123'
                };

                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showStatus(`‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng: ${data.user.fullName}`, 'success');
                    showResults('Login Success', data, 'success');
                } else {
                    showStatus(`‚ùå ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: ${data.message}`, 'danger');
                    showResults('Login Failed', data, 'danger');
                }
            } catch (error) {
                showStatus(`‚ùå L·ªói k·∫øt n·ªëi: ${error.message}`, 'danger');
            }
        });

        // 3. Test Profile API
        document.getElementById('testProfile').addEventListener('click', async () => {
            showStatus('ƒêang test profile API...', 'info');
            try {
                const response = await fetch('/api/database/test-profile');
                const data = await response.json();

                if (response.ok) {
                    showStatus('‚úÖ Profile API test ho√†n t·∫•t!', 'success');
                    showResults('Profile Test Results', data, 'success');
                } else {
                    showStatus(`‚ùå Profile test th·∫•t b·∫°i: ${data.message}`, 'danger');
                    showResults('Profile Test Error', data, 'danger');
                }
            } catch (error) {
                showStatus(`‚ùå L·ªói k·∫øt n·ªëi: ${error.message}`, 'danger');
            }
        });

        // 4. Test My Appointments
        document.getElementById('testMyAppointments').addEventListener('click', async () => {
            showStatus('ƒêang test my appointments API...', 'info');
            try {
                const response = await fetch('/api/appointments/my-appointments');
                const data = await response.json();

                if (response.ok) {
                    showStatus(`‚úÖ T√¨m th·∫•y ${data.appointments.length} appointments!`, 'success');
                    showResults('My Appointments', data, 'success');
                } else {
                    showStatus(`‚ùå L·ªói appointments: ${data.message}`, 'danger');
                    showResults('Appointments Error', data, 'danger');
                }
            } catch (error) {
                showStatus(`‚ùå L·ªói k·∫øt n·ªëi: ${error.message}`, 'danger');
            }
        });

        // 5. Test React App Navigation
        document.getElementById('testReactApp').addEventListener('click', () => {
            showStatus('üöÄ Testing React App Navigation...', 'info');

            // Try to call navigateTo function if it exists
            if (typeof window.navigateTo === 'function') {
                showStatus('‚úÖ React navigateTo function t·ªìn t·∫°i!', 'success');
                showResults('React Navigation Test', {
                    navigateToExists: true,
                    message: 'C√≥ th·ªÉ s·ª≠ d·ª•ng window.navigateTo("/profile") ƒë·ªÉ navigate'
                }, 'success');

                // Test navigation
                setTimeout(() => {
                    if (confirm('B·∫°n c√≥ mu·ªën navigate ƒë·∫øn /profile trong React app?')) {
                        window.navigateTo('/profile');
                    }
                }, 1000);
            } else {
                showStatus('‚ö†Ô∏è React navigateTo function kh√¥ng t·ªìn t·∫°i', 'warning');
                showResults('React Navigation Test', {
                    navigateToExists: false,
                    message: 'React app c√≥ th·ªÉ ch∆∞a load ho·∫∑c c√≥ l·ªói'
                }, 'warning');
            }
        });

        // Auto-run auth check on load
        window.addEventListener('load', () => {
            document.getElementById('checkAuthStatus').click();
        });
    </script>
</body>

</html>