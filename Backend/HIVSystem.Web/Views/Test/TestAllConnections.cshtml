@{
    ViewData["Title"] = "Test All Connection Strings";
}

<div class="container">
    <h2><i class="fas fa-plug"></i> Test All Connection Strings</h2>
    
    <div class="alert alert-info">
        <h5>üîç Ki·ªÉm tra t·∫•t c·∫£ connection strings c√≥ th·ªÉ:</h5>
        <p>Trang n√†y s·∫Ω test t·∫•t c·∫£ connection strings v√† cho bi·∫øt c√°i n√†o ho·∫°t ƒë·ªông.</p>
    </div>

    @if (ViewBag.Results != null)
    {
        <div class="row">
            @foreach (var result in (List<dynamic>)ViewBag.Results)
            {
                <div class="col-md-12 mb-3">
                    <div class="card @(result.CanConnect ? "border-success" : "border-danger")">
                        <div class="card-header @(result.CanConnect ? "bg-success text-white" : "bg-danger text-white")">
                            <h5 class="mb-0">
                                @if (result.CanConnect)
                                {
                                    <i class="fas fa-check-circle"></i>
                                }
                                else
                                {
                                    <i class="fas fa-times-circle"></i>
                                }
                                @result.Name
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <strong>Tr·∫°ng th√°i:</strong>
                                    @if (result.CanConnect)
                                    {
                                        <span class="badge bg-success">‚úÖ K·∫øt n·ªëi th√†nh c√¥ng</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">‚ùå K·∫øt n·ªëi th·∫•t b·∫°i</span>
                                    }
                                </div>
                                <div class="col-md-3">
                                    <strong>Database t·ªìn t·∫°i:</strong>
                                    @if (result.DatabaseExists)
                                    {
                                        <span class="badge bg-success">‚úÖ C√≥</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-warning">‚ö†Ô∏è Kh√¥ng</span>
                                    }
                                </div>
                                <div class="col-md-6">
                                    @if (result.CanConnect && result.DatabaseExists)
                                    {
                                        <a href="#" onclick="useThisConnection('@result.Name')" class="btn btn-success btn-sm">
                                            <i class="fas fa-check"></i> D√πng connection n√†y
                                        </a>
                                    }
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <strong>Connection String:</strong>
                                <div class="form-control bg-light" style="min-height: 50px; word-break: break-all; font-family: monospace; font-size: 12px;">
                                    @result.ConnectionString
                                </div>
                            </div>
                            
                            @if (!string.IsNullOrEmpty(result.Error))
                            {
                                <div class="mt-3">
                                    <strong>L·ªói:</strong>
                                    <div class="alert alert-danger">
                                        @result.Error
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <div class="mt-4">
        <div class="card">
            <div class="card-header">
                <h4>üìã H∆∞·ªõng d·∫´n x·ª≠ l√Ω</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>‚úÖ N·∫øu c√≥ connection th√†nh c√¥ng:</h5>
                        <ol>
                            <li>Click "D√πng connection n√†y" ·ªü connection th√†nh c√¥ng</li>
                            <li>N·∫øu database ch∆∞a t·ªìn t·∫°i, ch·∫°y script SQL t·∫°o database</li>
                            <li>Test l·∫°i ·ªü trang Database</li>
                        </ol>
                    </div>
                    <div class="col-md-6">
                        <h5>‚ùå N·∫øu t·∫•t c·∫£ ƒë·ªÅu th·∫•t b·∫°i:</h5>
                        <ol>
                            <li>Ki·ªÉm tra SQL Server ƒëang ch·∫°y kh√¥ng</li>
                            <li>M·ªü Services ‚Üí SQL Server (MSSQLSERVER/SQLEXPRESS)</li>
                            <li>C√†i SQL Server Express n·∫øu ch∆∞a c√≥</li>
                            <li>Th·ª≠ LocalDB option</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 text-center">
        <a href="/Test/Database" class="btn btn-primary">
            <i class="fas fa-database"></i> Test Database
        </a>
        <a href="/Test/TestConnection" class="btn btn-info">
            <i class="fas fa-cog"></i> Troubleshooting
        </a>
        <a href="javascript:location.reload()" class="btn btn-secondary">
            <i class="fas fa-refresh"></i> Test l·∫°i
        </a>
    </div>
</div>

<script>
function useThisConnection(connectionName) {
    alert('ƒê·ªÉ s·ª≠ d·ª•ng connection "' + connectionName + '":\n\n' +
          '1. Copy connection string\n' +
          '2. Paste v√†o appsettings.json\n' +
          '3. Restart ·ª©ng d·ª•ng\n' +
          '4. Test l·∫°i');
}
</script> 