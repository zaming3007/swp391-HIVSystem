@{
    ViewData["Title"] = "Compare Hash Algorithms";
}

<div class="container">
    <h2><i class="fas fa-balance-scale"></i> Compare Hash Algorithms</h2>
    
    @if (!string.IsNullOrEmpty(ViewBag.Error))
    {
        <div class="alert alert-danger">
            <h4>‚ùå L·ªói:</h4>
            <p>@ViewBag.Error</p>
        </div>
    }
    else if (ViewBag.Username != null)
    {
        <div class="alert alert-info">
            <h5>üîç So s√°nh hash cho user: <strong>@ViewBag.Username</strong></h5>
            <p>Password test: <code>@ViewBag.TestPassword</code></p>
            <p><strong>Algorithm ƒë√∫ng:</strong> <span class="badge bg-success">@ViewBag.CorrectAlgorithm</span></p>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h4>üìä Hash trong Database</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-control bg-light" style="font-family: monospace; word-break: break-all; min-height: 50px;">
                            @ViewBag.StoredHash
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h4>üß™ So s√°nh v·ªõi c√°c Algorithm</h4>
                </div>
                <div class="card-body">
                    @if (ViewBag.Comparisons != null)
                    {
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Algorithm</th>
                                        <th>Generated Hash</th>
                                        <th>Match</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var comp in (List<dynamic>)ViewBag.Comparisons)
                                    {
                                        <tr class="@(comp.Match ? "table-success" : "table-danger")">
                                            <td>
                                                <strong>@comp.Algorithm</strong>
                                                @if (comp.Match)
                                                {
                                                    <span class="badge bg-success ms-2">‚úÖ ƒê√öNG</span>
                                                }
                                            </td>
                                            <td style="font-family: monospace; font-size: 11px; word-break: break-all;">
                                                @comp.Generated
                                            </td>
                                            <td>
                                                @if (comp.Match)
                                                {
                                                    <i class="fas fa-check-circle text-success"></i>
                                                }
                                                else
                                                {
                                                    <i class="fas fa-times-circle text-danger"></i>
                                                }
                                            </td>
                                            <td>
                                                @if (comp.Match)
                                                {
                                                    <span class="badge bg-success">Algorithm n√†y ƒë√∫ng!</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">Kh√¥ng kh·ªõp</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h4>üí° Gi·∫£i th√≠ch & Gi·∫£i ph√°p</h4>
                </div>
                <div class="card-body">
                    @if (ViewBag.CorrectAlgorithm != "Kh√¥ng t√¨m th·∫•y")
                    {
                        <div class="alert alert-success">
                            <h5>‚úÖ T√¨m th·∫•y algorithm ƒë√∫ng!</h5>
                            <p>Database s·ª≠ d·ª•ng: <strong>@ViewBag.CorrectAlgorithm</strong></p>
                            <p>·ª®ng d·ª•ng hi·ªán t·∫°i d√πng: <strong>SHA256 + Base64</strong></p>
                            
                            @if (ViewBag.CorrectAlgorithm != "SHA256 + Base64")
                            {
                                <hr>
                                <p><strong>‚ùó Nguy√™n nh√¢n l·ªói:</strong> Algorithm kh√¥ng kh·ªõp!</p>
                                <p><strong>üí° Gi·∫£i ph√°p:</strong></p>
                                <ul>
                                    <li>C·∫≠p nh·∫≠t code ƒë·ªÉ d√πng algorithm: <strong>@ViewBag.CorrectAlgorithm</strong></li>
                                    <li>Ho·∫∑c ch·∫°y "Fix Password Hashes" ƒë·ªÉ chu·∫©n h√≥a t·∫•t c·∫£ v·ªÅ SHA256</li>
                                </ul>
                            }
                            else
                            {
                                <p><strong>‚úÖ Algorithm ƒë√£ ƒë√∫ng!</strong> Kh√¥ng c·∫ßn thay ƒë·ªïi g√¨.</p>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            <h5>‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y algorithm ƒë√∫ng!</h5>
                            <p>C√≥ th·ªÉ password trong database ƒë∆∞·ª£c t·∫°o b·∫±ng c√°ch kh√°c.</p>
                            <p><strong>Gi·∫£i ph√°p:</strong></p>
                            <ul>
                                <li>Ch·∫°y "Fix Password Hashes" ƒë·ªÉ reset t·∫•t c·∫£ passwords</li>
                                <li>Ho·∫∑c t·∫°o l·∫°i user v·ªõi password m·ªõi</li>
                            </ul>
                        </div>
                    }
                </div>
            </div>
        </div>
    }

    <div class="mt-4 text-center">
        <a href="/Test/CompareHashes?username=admin" class="btn btn-primary">Admin</a>
        <a href="/Test/CompareHashes?username=doctor" class="btn btn-primary">Doctor</a>
        <a href="/Test/CompareHashes?username=patient" class="btn btn-primary">Patient</a>
        <a href="/Test/FixPasswordHashes" class="btn btn-warning">Fix All Passwords</a>
        <a href="/Test/DebugHash" class="btn btn-info">Debug Hash</a>
        <a href="/Test/Database" class="btn btn-secondary">Back to Database</a>
    </div>
</div> 